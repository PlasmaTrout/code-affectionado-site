
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <script src="/js/vendor/modernizr.js"></script>
  <meta charset="utf-8">
  <title>Apache Felix - Pax Exam and Unit Testing Felix Bundles (Java 1.8 Version) | CodeAffectionado</title>
  <meta name="author" content="jeff.downing@latchd.com">

  
  <meta name="description" content="Apache Felix - Pax Exam and Unit Testing Felix Bundles (Java 1.8 Version) May 21, 2015 --> OSGi has been a mature framework for building modular &hellip;">
  

  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.codeaffectionado.com/labs-and-tutorials/osgi/apache-felix-pax-exam-java8">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="CodeAffectionado" type="application/atom+xml">

  <script src="/js/vendor/jquery.js"></script>
  <script src="/js/vendor/fastclick.js"></script>

  <script src="/js/foundation.min.js"></script>

  <script src="/javascripts/octopress.js" type="text/javascript"></script>


  <script>

  $(document).ready(function(){
    $(document).foundation();
  });

  </script>

  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=Roboto:300,300italic,500,500italic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Ubuntu:500' rel='stylesheet' type='text/css'>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-43174506-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body  >
  <header role="banner" class="top-header">
</header>
  <nav role="navigation"><ul class="subscription hide" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>


  <nav class="top-bar" data-topbar>

    <!--Uncomment CodeAffectionado below if you would like a title area on the left side of the nav bar-->

    <ul class="title-area">
        <li class="name">
          <h1><a href="/">CodeAffectionado</a></h1>
        </li>
        <li class="toggle-topbar menu-icon"><a href="#">Menu</a></li>
    </ul>


    <section class="top-bar-section">

      <ul class="main-navigation right">

          <li><a href="/">Home</a></li>
      	  <li class="has-dropdown">
            <a href="/labs-and-tutorials">Tutorials</a>
        		<ul class="dropdown">
        		   <li><a href="/labs-and-tutorials/osgi/">OSGi</a></li>
        		   <li><a href="/labs-and-tutorials/apache-jackrabbit/">Apache Jackrabbit</a></li>
        		</ul>
          <li>

          <!--<li class="has-dropdown">
            <a href="/no-sidebar">No Sidebar Page</a>

            <ul class="dropdown">
              <li><a href="/no-sidebar/left-sidebar">Left Sidebar Page</a></li>
              <li><a href="/no-sidebar/right-sidebar">Right Sidebar Page</a></li>
              <li><a href="/no-sidebar/example-formatting">Example Formatting</a></li>
            </ul>

          </li>-->

          <li><a href="/blog/archives">Archives</a></li>

      </ul>

    </section>
  </nav>


</nav>
  <div id="main">
    <div id="content" class="row">
        <div class="small-12 medium-12 large-8 columns">
  <article role="article">
    
    <header class="page-header">
      <h1 class="page-title">Apache Felix - Pax Exam and Unit Testing Felix Bundles (Java 1.8 Version)</h1>
      
      <!--<p class="meta">








  


<i class="fa fa-calendar-o"></i> <time datetime="2015-05-21T00:13:00-04:00" pubdate data-updated="true">May 21, 2015</time> </p>-->
    </header>
    
    <p>OSGi has been a mature framework for building modular applications for quite some time. It has however, not not been embraced fully by the development community. The primary reason it stays unpopular in the development arena lies in its lack of beginning level tutorials or classes. This tutorial begins a series of labs to demystify the OSGi framework and begin familiarity with Apache Felix.</p>

<p>Coding and deploying to a framework just to test a components functionality is somewhat cumbersome. This tutorial shows how to use Pax Exam to snap in unit tests to our bundle. The intent is to encourage more test driven design and reward service isolation with minimal dependencies.</p>

<h2>Audience</h2>

<p>The core audience is seated in a comfortable classroom or conference room environment. Readers performing this tutorial have received an overview of OSGi and completed a previous lab in which we setup a framework for use. A reader performing this tutorial would have a printed version of this media or the web site up on one screen while they work on code in another. The audience can be made up of developers from different disciplines but knowledge and understanding of the Java language is assumed.</p>

<h2>Overview</h2>

<p>In our previous <a href="/osgi/2013/08/14/apache-felix---modifying-our-first-bundle-for-declaritive-services/">example tutorial</a> we created an OSGi bundle using declarative services. However, to test our bundle we needed to create a GOGO Shell command and run it manually to validate that the bundle was operating correctly. In this tutorial we will remove that command binding and use a unit testing framework to test our bundle.</p>

<p>If you haven&rsquo;t done the first few bundle tutorials mentioned above you can grab the source at:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Lab Quick Start Code</span><a href='https://github.com/PlasmaTrout/greeter-bundle-lab4'>GitHub</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git clone git@github.com:PlasmaTrout/greeter-bundle-lab4.git
</span></code></pre></td></tr></table></div></figure></notextile></div>


<h2>Remove Our Command Class and Its XML File</h2>

<p>In this step we are going to find and remove our command package from the project tree. Once we get to Apache Sling (which is where we are going by the way) we can just make some web pages to display our results. So delete the command package and the files in it and remove the greetcommandcomponent.xml file as well. We are done with it for now.</p>

<p>So now our JAR file is a bit smaller. If we take a look we can see the command is no more:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Bundle Jar Contents</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>450 Wed Aug 14 16:03:34 EDT 2013 META-INF/MANIFEST.MF
</span><span class='line'>0 Wed Aug 14 16:03:34 EDT 2013 META-INF/
</span><span class='line'>0 Wed Aug 14 16:03:34 EDT 2013 OSGI-INF/
</span><span class='line'>333 Wed Aug 14 15:58:16 EDT 2013 OSGI-INF/greetercomponent.xml
</span><span class='line'>0 Wed Aug 14 16:03:34 EDT 2013 org/
</span><span class='line'>0 Wed Aug 14 16:03:34 EDT 2013 org/bhn/
</span><span class='line'>0 Wed Aug 14 16:03:34 EDT 2013 org/bhn/training/
</span><span class='line'>0 Wed Aug 14 16:03:34 EDT 2013 org/bhn/training/api/
</span><span class='line'>155 Wed Aug 14 16:03:32 EDT 2013 org/bhn/training/api/Greeter.class
</span><span class='line'>0 Wed Aug 14 16:03:34 EDT 2013 org/bhn/training/impl/
</span><span class='line'>482 Wed Aug 14 16:03:32 EDT 2013 org/bhn/training/impl/SimpleStringGreeterImpl.class
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p>After you finish, take a look at your POM.xml and remove the Service-Component entry for the file you just removed. We also need to add some magical lines for our Pax Exam tests, so it should end up like:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Modifying The Maven Plugin</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;plugin&gt;</span>
</span><span class='line'>    <span class="nt">&lt;groupId&gt;</span>org.apache.felix<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'>    <span class="nt">&lt;artifactId&gt;</span>maven-bundle-plugin<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'>    <span class="nt">&lt;version&gt;</span>2.3.7<span class="nt">&lt;/version&gt;</span>
</span><span class='line'>    <span class="nt">&lt;extensions&gt;</span>true<span class="nt">&lt;/extensions&gt;</span>
</span><span class='line'>    <span class="nt">&lt;configuration&gt;</span>
</span><span class='line'>        <span class="nt">&lt;instructions&gt;</span>
</span><span class='line'>            <span class="nt">&lt;Bundle-Name&gt;</span>${project.name}<span class="nt">&lt;/Bundle-Name&gt;</span>
</span><span class='line'>            <span class="nt">&lt;Bundle-SymbolicName&gt;</span>${project.artifactId}<span class="nt">&lt;/Bundle-SymbolicName&gt;</span>
</span><span class='line'>            <span class="nt">&lt;Export-Package&gt;</span>org.bhn.training.api<span class="nt">&lt;/Export-Package&gt;</span>
</span><span class='line'>            <span class="nt">&lt;Service-Component&gt;</span>OSGI-INF/greetercomponent.xml<span class="nt">&lt;/Service-Component&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/instructions&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/configuration&gt;</span>
</span><span class='line'>    <span class="nt">&lt;executions&gt;</span>
</span><span class='line'>        <span class="nt">&lt;execution&gt;</span>
</span><span class='line'>            <span class="nt">&lt;goals&gt;</span>
</span><span class='line'>                <span class="nt">&lt;goal&gt;</span>manifest<span class="nt">&lt;/goal&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/goals&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/execution&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/executions&gt;</span>
</span><span class='line'><span class="nt">&lt;/plugin&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p>The new goal is to ensure that the manifest is actually written at a different part of the lifecycle. It&rsquo;s really just to improve the process of testing the bundle. Without this line you would end up with errors indicating that the manifest didn&rsquo;t exist during the testing phase. Putting this line in ensures that it really will exist prior to the test being run.</p>

<h2>Add A Few More Maven Dependencies</h2>

<p>So now we need to add a few Maven dependencies. I won&rsquo;t explain them, just know that they are requirements for Pax Exam and are available in their documentation. We are also going to scope most of them to test only anyways. In your POM.xml add the following dependency chain:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Pax Exam POM Dependencies</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;dependencies&gt;</span>
</span><span class='line'>  <span class="nt">&lt;dependency&gt;</span>
</span><span class='line'>      <span class="nt">&lt;groupId&gt;</span>org.slf4j<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'>      <span class="nt">&lt;artifactId&gt;</span>slf4j-simple<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'>      <span class="nt">&lt;version&gt;</span>1.7.12<span class="nt">&lt;/version&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/dependency&gt;</span>
</span><span class='line'>    <span class="nt">&lt;dependency&gt;</span>
</span><span class='line'>        <span class="nt">&lt;groupId&gt;</span>org.ops4j.pax.exam<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'>        <span class="nt">&lt;artifactId&gt;</span>pax-exam-container-native<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'>        <span class="nt">&lt;version&gt;</span>${pax.exam.version}<span class="nt">&lt;/version&gt;</span>
</span><span class='line'>        <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/dependency&gt;</span>
</span><span class='line'>    <span class="nt">&lt;dependency&gt;</span>
</span><span class='line'>        <span class="nt">&lt;groupId&gt;</span>org.ops4j.pax.exam<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'>        <span class="nt">&lt;artifactId&gt;</span>pax-exam-junit4<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'>        <span class="nt">&lt;version&gt;</span>${pax.exam.version}<span class="nt">&lt;/version&gt;</span>
</span><span class='line'>        <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/dependency&gt;</span>
</span><span class='line'>    <span class="nt">&lt;dependency&gt;</span>
</span><span class='line'>        <span class="nt">&lt;groupId&gt;</span>org.ops4j.pax.exam<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'>        <span class="nt">&lt;artifactId&gt;</span>pax-exam-link-mvn<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'>        <span class="nt">&lt;version&gt;</span>${pax.exam.version}<span class="nt">&lt;/version&gt;</span>
</span><span class='line'>        <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/dependency&gt;</span>
</span><span class='line'>    <span class="nt">&lt;dependency&gt;</span>
</span><span class='line'>        <span class="nt">&lt;groupId&gt;</span>org.ops4j.pax.url<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'>        <span class="nt">&lt;artifactId&gt;</span>pax-url-aether<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'>        <span class="nt">&lt;version&gt;</span>${url.version}<span class="nt">&lt;/version&gt;</span>
</span><span class='line'>        <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/dependency&gt;</span>
</span><span class='line'>    <span class="nt">&lt;dependency&gt;</span>
</span><span class='line'>        <span class="nt">&lt;groupId&gt;</span>org.apache.felix<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'>        <span class="nt">&lt;artifactId&gt;</span>org.apache.felix.framework<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'>        <span class="nt">&lt;version&gt;</span>5.0.0<span class="nt">&lt;/version&gt;</span>
</span><span class='line'>        <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/dependency&gt;</span>
</span><span class='line'>    <span class="nt">&lt;dependency&gt;</span>
</span><span class='line'>        <span class="nt">&lt;groupId&gt;</span>ch.qos.logback<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'>        <span class="nt">&lt;artifactId&gt;</span>logback-core<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'>        <span class="nt">&lt;version&gt;</span>0.9.20<span class="nt">&lt;/version&gt;</span>
</span><span class='line'>        <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/dependency&gt;</span>
</span><span class='line'>    <span class="nt">&lt;dependency&gt;</span>
</span><span class='line'>        <span class="nt">&lt;groupId&gt;</span>ch.qos.logback<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'>        <span class="nt">&lt;artifactId&gt;</span>logback-classic<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'>        <span class="nt">&lt;version&gt;</span>0.9.20<span class="nt">&lt;/version&gt;</span>
</span><span class='line'>        <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/dependency&gt;</span>
</span><span class='line'>    <span class="nt">&lt;dependency&gt;</span>
</span><span class='line'>        <span class="nt">&lt;groupId&gt;</span>junit<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'>        <span class="nt">&lt;artifactId&gt;</span>junit<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'>        <span class="nt">&lt;version&gt;</span>4.12<span class="nt">&lt;/version&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/dependency&gt;</span>
</span><span class='line'><span class="nt">&lt;/dependencies&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p>And at the top of your POM add the following section right under the name of our project:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;properties&gt;</span>
</span><span class='line'>      <span class="nt">&lt;pax.exam.version&gt;</span>4.5.0<span class="nt">&lt;/pax.exam.version&gt;</span>
</span><span class='line'>      <span class="nt">&lt;url.version&gt;</span>1.6.0<span class="nt">&lt;/url.version&gt;</span>
</span><span class='line'><span class="nt">&lt;/properties&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p>Thats really all we had to do in this step. Its probably best that we run a <strong>mvn package</strong> or <strong>mvn test</strong> just to make sure we have no Maven errors.</p>

<h2>Modify Our Existing JUnit Test To Use PaxRunner</h2>

<p>We already have a unit test that was created with the quick start archetype. Up to now we have been mostly ignoring it. Lets make it do some work. Locate your AppTest.java file and lets rename it to GreetingPaxExamTest.java so it describes itself a bit.</p>

<p>Now lets decorate the top of it with some annotations that will help Pax Exam pick up on its existence (I&rsquo;m omitting the imports that are needed to support these, I&rsquo;m hoping your IDE does some work here):</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Decorating Our Test Class With Some Annotations</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@RunWith</span><span class="o">(</span><span class="n">PaxExam</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
</span><span class='line'><span class="nd">@ExamReactorStrategy</span><span class="o">(</span><span class="n">PerClass</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">GreeterPaxExamTest</span>
</span><span class='line'>    <span class="kd">extends</span> <span class="n">TestCase</span>
</span><span class='line'><span class="o">{</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p>The first is a common annotation to change what runner (test system) that the unit test will run on. Without this annotation, Maven will default to its own runner and we don&rsquo;t want that in this case. We want it to use Pax-Exams test runner.</p>

<p>The second tells Pax Exam what kind of strategy to use when starting and stopping the container. With our selection a brand new test container is started and stopped for each test class that is run.</p>

<h3>Create Config Method</h3>

<p>Pax Exams uses a special configuration method to help it load the framework when the test is being run. It&rsquo;s important that we add the bundles we need to it, just like we would do to a stand-alone Felix framework. Place this method in your test class:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Test Class Configuration Method</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Configuration</span>
</span><span class='line'><span class="kd">public</span> <span class="n">Option</span><span class="o">[]</span> <span class="nf">config</span><span class="o">(){</span>
</span><span class='line'>    <span class="k">return</span> <span class="nf">options</span><span class="o">(</span>
</span><span class='line'>            <span class="n">mavenBundle</span><span class="o">(</span><span class="s">&quot;org.apache.felix&quot;</span><span class="o">,</span><span class="s">&quot;org.apache.felix.scr&quot;</span><span class="o">,</span><span class="s">&quot;1.6.2&quot;</span><span class="o">),</span>
</span><span class='line'>            <span class="n">bundle</span><span class="o">(</span><span class="s">&quot;reference:file:target/classes&quot;</span><span class="o">),</span>
</span><span class='line'>            <span class="n">junitBundles</span><span class="o">()</span>
</span><span class='line'>    <span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p>This method is called by the runner to know how to load the OSGi framework up with bundles prior to the test launching. The syntax is a little strange, but just know that Pax Exam exposed a few static helpers that attempts to make things easier.</p>

<h3>Create A Unit Test</h3>

<p>Now we need is an actual test, lets modify the create one to look like:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Test Class Test Method</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Test</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">simpleGreetingImplCheck</span><span class="o">(){</span>
</span><span class='line'>  <span class="c1">// test will go here  </span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p>So far we really aren&rsquo;t testing anything specific, but just to test your setup run <strong>mvn test</strong> and watch what happens now.</p>

<p>All of that logged information that flew by was telling your about a framework startup and shutdown. Notice its really fast for starting and stopping a bundle.</p>

<h2>Getting The Greater Service From A Unit Test</h2>

<p>So we want to test our greeter service. We know that typically we ask the context for an instance of the service that implements an interface. So our basic question usually is &ldquo;Hey framework, I need whatever implements this interface.&rdquo; the framework usually responds &ldquo;ok&rdquo; and gives it to you. To do that in our test, we need to inject a variable. This is very similar to what you will do in you code in later tutorials when you use them using SCR annotations, but it uses a different keyword. Lets create the following field in our test class:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Test Class Injection Example</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Inject</span>
</span><span class='line'><span class="kd">private</span> <span class="n">Greeter</span> <span class="n">greeter</span><span class="o">;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p><em>Note: The import for inject is javax.inject.Inject. Some IDE&rsquo;s will put googles first, just know you want the javax annotation.</em></p>

<p>Now lets use that interface in our test. Notice that I <strong>WILL NOT</strong> instantiate anything the framework will handle that. Change your test to look like:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Test Class Unit Test</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Test</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">simpleGreetingImplCheck</span><span class="o">()</span>
</span><span class='line'><span class="o">{</span>
</span><span class='line'>    <span class="n">String</span> <span class="n">testValue</span> <span class="o">=</span> <span class="n">greeter</span><span class="o">.</span><span class="na">greet</span><span class="o">();</span>
</span><span class='line'>    <span class="n">assertEquals</span><span class="o">(</span><span class="n">testValue</span><span class="o">,</span><span class="s">&quot;Hello World Fail!&quot;</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p>Just in case your having trouble, the final test class should look like the following:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span> (GreeterPaxExamTest2.java)</span> <a href='/downloads/code/GreeterPaxExamTest2.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">org</span><span class="o">.</span><span class="na">bhn</span><span class="o">.</span><span class="na">training</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.bhn.training.api.Greeter</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">junit.framework.TestCase</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.junit.runner.RunWith</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.ops4j.pax.exam.Configuration</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.ops4j.pax.exam.Option</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.ops4j.pax.exam.junit.PaxExam</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.ops4j.pax.exam.spi.reactors.ExamReactorStrategy</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.ops4j.pax.exam.spi.reactors.PerClass</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">javax.inject.Inject</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">ops4j</span><span class="o">.</span><span class="na">pax</span><span class="o">.</span><span class="na">exam</span><span class="o">.</span><span class="na">CoreOptions</span><span class="o">.*;</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@RunWith</span><span class="o">(</span><span class="n">PaxExam</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
</span><span class='line'><span class="nd">@ExamReactorStrategy</span><span class="o">(</span><span class="n">PerClass</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">GreeterPaxExamTest</span>
</span><span class='line'>    <span class="kd">extends</span> <span class="n">TestCase</span>
</span><span class='line'><span class="o">{</span>
</span><span class='line'>    <span class="nd">@Inject</span>
</span><span class='line'>    <span class="kd">private</span> <span class="n">Greeter</span> <span class="n">greeter</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Configuration</span>
</span><span class='line'>    <span class="kd">public</span> <span class="n">Option</span><span class="o">[]</span> <span class="nf">config</span><span class="o">(){</span>
</span><span class='line'>        <span class="k">return</span> <span class="nf">options</span><span class="o">(</span>
</span><span class='line'>                <span class="n">mavenBundle</span><span class="o">(</span><span class="s">&quot;org.apache.felix&quot;</span><span class="o">,</span><span class="s">&quot;org.apache.felix.scr&quot;</span><span class="o">,</span><span class="s">&quot;1.6.2&quot;</span><span class="o">),</span>
</span><span class='line'>                <span class="c1">//mavenBundle(&quot;org.bhn.training&quot;,&quot;greeter-bundle&quot;),</span>
</span><span class='line'>                <span class="n">bundle</span><span class="o">(</span><span class="s">&quot;reference:file:target/classes&quot;</span><span class="o">),</span>
</span><span class='line'>                <span class="n">junitBundles</span><span class="o">()</span>
</span><span class='line'>        <span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Test</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">simpleGreetingImplCheck</span><span class="o">()</span>
</span><span class='line'>    <span class="o">{</span>
</span><span class='line'>        <span class="n">String</span> <span class="n">testValue</span> <span class="o">=</span> <span class="n">greeter</span><span class="o">.</span><span class="na">greet</span><span class="o">();</span>
</span><span class='line'>        <span class="n">assertEquals</span><span class="o">(</span><span class="n">testValue</span><span class="o">,</span><span class="s">&quot;Hello World!&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<h2>Build Our Application and Run Unit Tests</h2>

<p>Now all we have to do is run a <strong>mvn test</strong> and see if we are working properly. This test was designed to fail just to prove that it is actually working. If you scroll up a little in the text you will see the line:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Example Failure Message</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">GreeterPax</span> <span class="n">ExamTest</span><span class="o">.</span><span class="na">simpleGreetingImplCheck</span><span class="o">:</span><span class="mi">39</span> <span class="nl">expected:</span><span class="o">&lt;</span><span class="n">Hello</span> <span class="n">World</span><span class="o">[]!&gt;</span> <span class="n">but</span> <span class="nl">was:</span><span class="o">&lt;</span><span class="n">Hello</span> <span class="n">World</span><span class="o">[</span> <span class="n">Fail</span><span class="o">]!&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p>This is due to our test case having the world fail in it. If we change it to just Hello World! it will pass.</p>

<p>With this setup we now can actually test our bundles prior to deploying them. In the next tutorial we will make declarative services one more step easier by removing the xml files and using our classes to define the component information.</p>

<p>If you want the source code you can find it at <a href="https://github.com/PlasmaTrout/greeter-bundle-lab5/tree/java8">https://github.com/PlasmaTrout/greeter-bundle-lab5/tree/java8</a> make sure to make note the java 1.8 version is on a different branch.</p>

<h2>Errors Encountered During This Series</h2>

<p>You may see some of these when trying to do this tutorial in Java 1.8.</p>

<h3>java.lang.NoSuchMethodError: org.osgi.framework.BundleEvent.<init>(ILorg/osgi/framework/Bundle;Lorg/osgi/framework/Bundle;)V</h3>

<p>This one is primarily due to an extra org.osgi.core bundle being declared in the pom. I had a dependency to:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;dependency&gt;</span>
</span><span class='line'>    <span class="nt">&lt;groupId&gt;</span>org.apache.felix<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'>    <span class="nt">&lt;artifactId&gt;</span>org.osgi.core<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'>    <span class="nt">&lt;version&gt;</span>1.4.0<span class="nt">&lt;/version&gt;</span>
</span><span class='line'>    <span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span>
</span><span class='line'><span class="nt">&lt;/dependency&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p>Which BTW is incredibly out of date. Once I removed it, everything worked fine.</p>

<h3>org.osgi.framework.BundleException: Unresolved constraint in bundle org.ops4j.pax.exam.invoker.junit [17]: Unable to resolve 17.0: (blah blah blah)</h3>

<p>All of this is due to the wrong Felix Framework vs Pax-Exam combination. I originally had:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;dependency&gt;</span>
</span><span class='line'>    <span class="nt">&lt;groupId&gt;</span>org.apache.felix<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'>    <span class="nt">&lt;artifactId&gt;</span>org.apache.felix.framework<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'>    <span class="nt">&lt;version&gt;</span>4.0.3<span class="nt">&lt;/version&gt;</span>
</span><span class='line'>    <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
</span><span class='line'><span class="nt">&lt;/dependency&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p>when I changed it to:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;dependency&gt;</span>
</span><span class='line'>    <span class="nt">&lt;groupId&gt;</span>org.apache.felix<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'>    <span class="nt">&lt;artifactId&gt;</span>org.apache.felix.framework<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'>    <span class="nt">&lt;version&gt;</span>5.0.0<span class="nt">&lt;/version&gt;</span>
</span><span class='line'>    <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
</span><span class='line'><span class="nt">&lt;/dependency&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p>Everything ran great!</p>

    
      <footer>
        <p class="meta">
          
          








  


<i class="fa fa-calendar-o"></i> <time datetime="2015-05-21T00:13:00-04:00" pubdate data-updated="true">May 21, 2015</time> 
          
        </p>
        
          <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://www.codeaffectionado.com/labs-and-tutorials/osgi/apache-felix-pax-exam-java8/index.html" data-via="mrjepp" data-counturl="http://www.codeaffectionado.com/labs-and-tutorials/osgi/apache-felix-pax-exam-java8/index.html" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

        
      </footer>
    
  </article>
  
    <section>
      <h1>Comments</h1>
      <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
    </section>
  
  </div><!--.columns-->
  
  <aside class="sidebar small-12 medium-12 large-4 columns">
    
      
  
<section>
	<h1>Lab/Tutorial Sections</h1>
	<ul id="recent_posts">
      <li class="post">
        <a href="/labs-and-tutorials/osgi/">OSGi</a>
      </li>
      <li>
      	<a href="/labs-and-tutorials/apache-jackrabbit/">Apache Jackrabbit</a>
      </li>
  </ul>
</section><section>
  <h1>Recent Posts <i class="fa fa-edit"></i></h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/05/18/new-video-osgi-services-vs-service-factories/">New Video: OSGi Services vs Service Factories</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/05/13/new-video-setup-bndtool-for-jsp-development/">New Video: Setting Up BndTools for JSP Development</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/05/13/setting-up-for-2015/">Setting Up for 2015 (Videos and More)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/10/16/hey-whats-with-this-wordpress-site/">Hey? Whats With This Wordpress Site?</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/10/16/new-osgi-tutorial-posted/">New OSGi Tutorial on Bndtools Posted</a>
      </li>
    
  </ul>
</section>

<section class="googleplus">
  <h3>
    <a href="https://plus.google.com/114996005873710645329?rel=author">
      <i class="fa fa-google-plus-square"></i> 
      Google+
    </a>
  </h3>
</section>



    
  </aside>
  


    </div>
  </div>
  <footer role="contentinfo"><p class="text-center">
  <span class="copyright">
  	Copyright &copy; 2015 by jeff.downing@latchd.com
  </span>

  <span class="credit">
  	Powered by <a href="http://octopress.org" target="_blank">Octopress</a><br />
  	<span><a href="http://github.com/annejohnson/octofound" target="_blank">Theme</a> by <a href="http://feathers.io" target="_blank">Anne Johnson</a></span>
  </span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'aggrolearning';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://www.codeaffectionado.com/labs-and-tutorials/osgi/apache-felix-pax-exam-java8/index.html';
        var disqus_url = 'http://www.codeaffectionado.com/labs-and-tutorials/osgi/apache-felix-pax-exam-java8/index.html';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>






</body>
</html>

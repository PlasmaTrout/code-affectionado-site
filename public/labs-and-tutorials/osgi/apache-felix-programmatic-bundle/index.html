
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Apache Felix - First Bundle The Programmatic Way - CodeAffectionado</title>
  <meta name="author" content="jeff.downing@latchd.com">

  
  <meta name="description" content="Apache Felix - First Bundle the Programmatic Way OSGi has been a mature framework for building modular applications for quite some time. It has &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.codeaffectionado.com/labs-and-tutorials/osgi/apache-felix-programmatic-bundle">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="CodeAffectionado" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-43174506-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">CodeAffectionado</a></h1>
  
    <h2>Aggressive learning for code enthusiasts</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.codeaffectionado.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">News</a></li>
  <li><a href="/labs-and-tutorials/">Labs And Tutorials</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article role="article">
  
  <header>
    <h1 class="entry-title">Apache Felix - First Bundle the Programmatic Way</h1>
    <p class="meta">








  


<time datetime="2013-08-19T13:59:00-04:00" pubdate data-updated="true"></time></p>
  </header>
  
  <p>OSGi has been a mature framework for building modular applications for quite some time. It has however, not not been embraced fully by the development community. The primary reason it stays unpopular in the development arena lies in its lack of beginning level tutorials or classes. This tutorial begins a series of labs to demystify the OSGi framework and begin familiarity with Apache Felix.</p>

<p>The purpose of this lab is to show the &ldquo;code only&rdquo; way to create a modular component for use in the OSGi framework. Understanding the manual way to do this assists in explaining the more abbreviated ways later.</p>

<h2 id="id-ef1e6887c579ba81dcedc3f4e3793cd2">1 Audience</h2>

<p>The core audience is seated in a comfortable classroom or conference room environment. Readers performing this tutorial have received an overview of OSGi and completed a previous lab in which we setup a framework for use. A reader performing this tutorial would have a printed version of this media or the web site up on one screen while they work on code in another. The audience can be made up of developers from different disciplines but knowledge and understanding of the Java language is assumed.</p>

<h2 id="id-bedc3dcfdda44f13f3ab09697de200d4">2 Generate A Maven Quick Start Java Project</h2>

<p>First, create a directory to place the project in. Using the $HOME/projects directory would more closely match what will be shown in the examples, but any directory will do. After changing into the directory, run the following command:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Starting A Quick Start Maven Project</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mvn archetype:generate -DgroupId<span class="o">=</span>org.bhn.training -DartifactId<span class="o">=</span>greeter-bundle -DarchetypeArtifactId<span class="o">=</span>maven-archetype-quickstart -DinteractiveMode<span class="o">=</span><span class="nb">false</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p>At this point Maven has created a very simple hello world application. It shouldn&rsquo;t do much if it&rsquo;s compiled and run, but it will be modified heavily the next steps anyways.</p>

<h2 id="id-e0bdd7a598f83ff5b041a606c7a05ad7">3 Change The POM</h2>

<p>Building bundles instead of JARS requires modification of the plugins declared in the POM to support building a new type of packaging.</p>

<p>The starter project has a very simple POM (which is why it was chosen). It really needs to be modified to support our new project type. So lets first add the appropriate maven plugin and configure it for making OSGi bundles. The main plugin needed to  create OSGi bundles is the maven-bundle-plugin. In order to set it up, add the following plugin:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>POM Modification</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'> <span class="nt">&lt;build&gt;</span>
</span><span class='line'>    <span class="nt">&lt;plugins&gt;</span>
</span><span class='line'>        <span class="nt">&lt;plugin&gt;</span>
</span><span class='line'>            <span class="nt">&lt;groupId&gt;</span>org.apache.felix<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'>            <span class="nt">&lt;artifactId&gt;</span>maven-bundle-plugin<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'>            <span class="nt">&lt;version&gt;</span>2.3.7<span class="nt">&lt;/version&gt;</span>
</span><span class='line'>            <span class="nt">&lt;extensions&gt;</span>true<span class="nt">&lt;/extensions&gt;</span>
</span><span class='line'>            <span class="nt">&lt;configuration&gt;</span>
</span><span class='line'>                <span class="nt">&lt;instructions&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;Bundle-Name&gt;</span>${project.name}<span class="nt">&lt;/Bundle-Name&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;Bundle-SymbolicName&gt;</span>${project.artifactId}<span class="nt">&lt;/Bundle-SymbolicName&gt;</span>
</span><span class='line'>                <span class="nt">&lt;/instructions&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/configuration&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/plugin&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/plugins&gt;</span>
</span><span class='line'><span class="nt">&lt;/build&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p>This plugins job is to expand the configuration instructions in JAR files manifest to include new bundle specific ones. The only real difference between a JAR and an OSGi Bundle is just some new attributes added to the manifest itself.</p>

<h2 id="id-71c5251db6987ffecb3cc64a74490f52">4 Starter Bundle Dependencies</h2>

<p>The bundle won&rsquo;t do very much without a few dependencies being added. Add the following starter dependencies into the dependencies section of the POM:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>POM Dependencies lang:xml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;dependency&gt;</span>
</span><span class='line'>    <span class="nt">&lt;groupId&gt;</span>org.apache.felix<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'>    <span class="nt">&lt;artifactId&gt;</span>org.osgi.core<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'>    <span class="nt">&lt;version&gt;</span>1.4.0<span class="nt">&lt;/version&gt;</span>
</span><span class='line'>    <span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span>
</span><span class='line'><span class="nt">&lt;/dependency&gt;</span>
</span><span class='line'><span class="nt">&lt;dependency&gt;</span>
</span><span class='line'>    <span class="nt">&lt;groupId&gt;</span>junit<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'>    <span class="nt">&lt;artifactId&gt;</span>junit<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'>    <span class="nt">&lt;version&gt;</span>4.8.2<span class="nt">&lt;/version&gt;</span>
</span><span class='line'><span class="nt">&lt;/dependency&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p>The org.osgi.core library is needed so references to the API can be used. JUnit is only there for future labs. It will come into play during the Pax Exam examples later.</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Change Packaging Type lang:xml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;groupId&gt;</span>com.bhn.training<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'><span class="nt">&lt;artifactId&gt;</span>greeter-bundle<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'><span class="nt">&lt;packaging&gt;</span>bundle<span class="nt">&lt;/packaging&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p>The bundle packaging definition will trigger our bundle plugin. If we run a <strong>mvn package</strong> now, we should get a build success. If so, this verified our plugins are working.</p>

<h2 id="id-763452fa1c88e9094653309787c8f732">5 Examining The JARS</h2>

<p>Lets go into the target directory of your project. There you should see a new jar file names greeter-bundle-1.0-SNAPSHOT.jar or something similar. If you execute the command:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Unpack And Examine Manifest</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>jar -xvf greeter-bundle-1.0-SNAPSHOT.jar META-INF/MANIFEST.MF
</span><span class='line'>cat META-INF/MANIFEST.MF
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p>You should see now that the manifest included with this JAR has some Bundle related properties. This differs quite a bit from a normal JAR manifest. For instance a normal JAR might look something like this:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Normal JAR Manifest</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Manifest-Version: 1.0
</span><span class='line'>Archiver-Version: Plexus Archiver
</span><span class='line'>Created-By: Apache Maven
</span><span class='line'>Built-By: PlasmaTrout
</span><span class='line'>Build-Jdk: 1.6.0_51
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p>However our new one, ends up very similar to:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>OSGi JAR Manifest</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Manifest-Version: 1.0
</span><span class='line'>Bnd-LastModified: 1376419554357
</span><span class='line'>Build-Jdk: 1.6.0_51
</span><span class='line'>Built-By: PlasmaTrout
</span><span class='line'>Bundle-ManifestVersion: 2
</span><span class='line'>Bundle-Name: greeter-bundle
</span><span class='line'>Bundle-SymbolicName: greeter-bundle
</span><span class='line'>Bundle-Version: 1.0.0.SNAPSHOT
</span><span class='line'>Created-By: Apache Maven Bundle Plugin
</span><span class='line'>Export-Package: org.bhn.training;version<span class="o">=</span><span class="s2">&quot;1.0.0.SNAPSHOT&quot;</span>
</span><span class='line'>Tool: Bnd-1.50.0
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p>Notice the extra entries? These will be become easier to understand later, but just know that since our plugin really only specified two (name and symbolic name), the plugin used some default values to fill our the rest for us.</p>

<h2 id="id-8a988fc8ceb12d56742508f03e60f54f">6 Writing Our Interface</h2>

<p>In a normal development workflow when building bundle, determination of what will be exposed as our API and what we will hide is first major design decision we should make. After this is done, we then should create an API bundle and an implementation bundle that implements our API. We almost always want to deploy them separately. The API becomes our public facing aspects and the implementation never gets exposed.</p>

<p>For the sake of making the tutorial simple however, we aren&rsquo;t going to separate our API from our interface just yet. Instead lets just create two different packages to put our code in.</p>

<p>Under the root namespace org.bhn.training add two new packages one named api and the other named impl. We should now have:</p>

<ol>
<li>org.bhn.training.api</li>
<li>org.bhn.training.impl</li>
</ol>


<p>In our <strong>api</strong> package lets create an interface called Greeter. Greeter should look like the following:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Greeter API Interface</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">org</span><span class="o">.</span><span class="na">bhn</span><span class="o">.</span><span class="na">training</span><span class="o">.</span><span class="na">api</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Greeter</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">String</span> <span class="nf">greet</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p>As you can see it, really won&rsquo;t do much. It will simply have a method called greet that will return a string if you call it with no arguments.</p>

<h2 id="id-579efc11d48e8ebbe67f9be59c8a3187">7 Writing The Implementation</h2>

<p>Now lets go to our <strong>impl</strong> package and add an implementation class named SimpleStringGreeterImpl.java to the project:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Greeter Implementation lang:java</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">org</span><span class="o">.</span><span class="na">bhn</span><span class="o">.</span><span class="na">training</span><span class="o">.</span><span class="na">impl</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.bhn.training.api.Greeter</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SimpleStringGreeterImpl</span> <span class="kd">implements</span> <span class="n">Greeter</span> <span class="o">{</span>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="n">String</span> <span class="nf">greet</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="s">&quot;Hello World!&quot;</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<h2 id="id-146ddd78ea3b666f65d84752f9c9658c">8 A Quick Note On Services</h2>

<p>The term service is somewhat abstract so lets attempt to explain this using a very simple example. Suppose we implemented this as a normal set of java libraries. Even if we separated the api from the implementation in different packages, we still have the same core problem. We want people to use our API by using the interface, and we don&rsquo;t want the &ldquo;new&rdquo; keyword to be used against the implementation. With no modification we are stuck with a situation in which a caller would have to do:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">Greeter</span> <span class="n">greeter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleStringGreeterImpl</span><span class="o">();</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p>Inside of their classes. This presents an immediate problem by coupling the callers class directly to the implementation class. If we needed to change the implementation, say to a RandomStringGreeterImpl we wouldn&rsquo;t be able to do so to everyone using greeter.</p>

<p>In order to better enhance this, most teams would create a factory interface and implementation so that they themselves could be in control of the implementation details. This ends up like:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">GreeterFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GreeterFactory</span><span class="o">();</span>
</span><span class='line'><span class="n">Greeter</span> <span class="n">greeter</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p>Better right? The downside is the GreeterFactory is now coupled. Many different injection possibilities exist to further help here, but all they really end up doing is moving the same issue to a different domain (like a config file). In the end, after all of that work though, someone will still use this in a class:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">SimpleStringGreeterImpl</span> <span class="n">impl</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleStringGreeterImpl</span><span class="o">();</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p>Regardless of your pattern, the implementation still had to be public, therefore it still was visible to the caller.</p>

<p>OSGi takes a unique approach to this. The bundles can declare what they will expose and what they will not at a namespace or package level. This means we can expose just the interface and nothing else. But wait a minute. If thats the case how do we get the implementation? We ask the service registry to give us an implementation based on the interface that we have and it does. It does so without us every knowing what the implementation was (though we can find out).</p>

<p>This is how we define services.</p>

<h2 id="id-12ed2e1a68f627e8ac67845f226676f6">9 Creating An Activator</h2>

<p>If we wanted to use our interface as a very simple service. What we need to do is register that service in a service registry. Then callers who have our interface can ask the service registry to give them an implementation that uses the interface.</p>

<p>The programmatic way to do this is to create an Activator. An activator in a bundle is represented as a class that implements the interface <a href="http://www.osgi.org/javadoc/r4v43/core/org/osgi/framework/BundleActivator.html">BundleActivator</a>. This interface exposes two methods that allow us to register and un-register services programmatically.</p>

<p>Let&rsquo;s rename App.java to SimpleActivator.java (It should be SimpleStringGreeterActivator buts that&rsquo;s too verbose for the tutorial right now). Then change it to look like the following:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Blank Activator Class</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">org</span><span class="o">.</span><span class="na">bhn</span><span class="o">.</span><span class="na">training</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.osgi.framework.BundleActivator</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.osgi.framework.BundleContext</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SimpleActivator</span> <span class="kd">implements</span> <span class="n">BundleActivator</span>
</span><span class='line'><span class="o">{</span>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">start</span><span class="o">(</span><span class="n">BundleContext</span> <span class="n">bundleContext</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span><span class='line'>      <span class="c1">// What to do when it starts</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">stop</span><span class="o">(</span><span class="n">BundleContext</span> <span class="n">bundleContext</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span><span class='line'>      <span class="c1">// What to do when it stops</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p>See the two methods it exposed? We will put some code in here in a second, but before we forget lets add the appropriate manifest entry so that the framework knows where this is. In the plugin that we set up earlier add this element to the instructions element:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Activator Instruction</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;Bundle-Activator&gt;</span>org.bhn.training.SimpleActivator<span class="nt">&lt;/Bundle-Activator&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p>This manifest entry tells the framework what class the activator is in so it can dynamically call the interface methods start and stop for it. If we build and checkout the manifest now we will see:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Manifest Revisited </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Manifest-Version: 1.0
</span><span class='line'>Bnd-LastModified: 1376421388797
</span><span class='line'>Build-Jdk: 1.6.0_51
</span><span class='line'>Built-By: JSDowning
</span><span class='line'>Bundle-Activator: org.bhn.training.SimpleActivator
</span><span class='line'>... bunch of other stuff ...</span></code></pre></td></tr></table></div></figure></notextile></div>


<h2 id="id-766ec51dd46abefd92a677496a504beb">10 Registering Services</h2>

<p>Now that we have an Activator, we must put some code in the start and stop methods to handle our service registration. The steps involved in registering a service are pretty simple.</p>

<ol>
<li>We get a reference to the BundleContext</li>
<li>We use registerService to create a ServiceRegistration</li>
<li>When done we use the ServiceRegistration to un-register the service.</li>
</ol>


<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Fully Functioning Activator</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">org</span><span class="o">.</span><span class="na">bhn</span><span class="o">.</span><span class="na">training</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.bhn.training.impl.SimpleStringGreeterImpl</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.osgi.framework.BundleActivator</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.osgi.framework.BundleContext</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.osgi.framework.ServiceRegistration</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.util.Hashtable</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SimpleActivator</span> <span class="kd">implements</span> <span class="n">BundleActivator</span>
</span><span class='line'><span class="o">{</span>
</span><span class='line'>    <span class="n">ServiceRegistration</span> <span class="n">registration</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">start</span><span class="o">(</span><span class="n">BundleContext</span> <span class="n">bundleContext</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">Hashtable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">props</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Hashtable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;();</span>
</span><span class='line'>      <span class="n">registration</span> <span class="o">=</span> <span class="n">bundleContext</span>
</span><span class='line'>          <span class="o">.</span><span class="na">registerService</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">bhn</span><span class="o">.</span><span class="na">training</span><span class="o">.</span><span class="na">api</span><span class="o">.</span><span class="na">Greeter</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span>
</span><span class='line'>          <span class="k">new</span> <span class="nf">SimpleStringGreeterImpl</span><span class="o">(),</span><span class="n">props</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">stop</span><span class="o">(</span><span class="n">BundleContext</span> <span class="n">bundleContext</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">registration</span><span class="o">.</span><span class="na">unregister</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<h2 id="id-9a73094b2f39b810bfc0e87532916ac5">11 Exposing Our Interface Package</h2>

<p>Then final thing we must do, in order to have our API visible, is explicitly tell OSGi to expose our interfaces. This can easily be done by adding this line to the maven plugin instructions:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Exposing Our API In Maven</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;Export-Package&gt;</span>org.bhn.training.api<span class="nt">&lt;/Export-Package&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p>This tells the framework to allow other bundles to see the package org.bhn.training.api. Since our interfaces are in that package, they will be exposed when we deploy it.</p>

<p>Notice that the impl class is never exposed. There is absolutely NO method here that someone could instantiate a new SimpleStringGreetingImpl(). Even though its public, it&rsquo;s not exposed by the framework. This gets to the heart of why OSGi is so modular. It&rsquo;s relatively impossible to couple your classes together without bad practices.</p>

<h2 id="id-ab6dd800317918d765936ecd09e5191f">12 Deploy Our Bundle</h2>

<p>We are going to use the command line to deploy it, but you don&rsquo;t have to. If you still have the web interface from the previous tutorial you can update and install it from there as well. But from the command line it looks like:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Deploying A Bundle Using Felix Command Line</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>g! felix:install file:/Users/PlasmaTrout/Projects/greeter-bundle/target/greeter-bundle-1.0-SNAPSHOT.jar
</span><span class='line'>Bundle ID: 13
</span><span class='line'>
</span><span class='line'>g! felix:start 13
</span></code></pre></td></tr></table></div></figure></notextile></div>


<h2 id="id-61185d3aa7b26911ecf79a701c893ef7">13 Create A Gogo Shell Command</h2>

<p>Our bundle was started but we still have no way of seeing it. Lets create a way to actually call it. We can use the Gogo shell and create a command by creating a class and method and then using our service registry again.</p>

<p>Create a new package named org.bhn.training.commands and put a class called GreeterCommands in it. Should end up like the following:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Making A Command Class</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">org</span><span class="o">.</span><span class="na">bhn</span><span class="o">.</span><span class="na">training</span><span class="o">.</span><span class="na">commands</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.bhn.training.api.Greeter</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.osgi.framework.BundleContext</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.osgi.framework.ServiceReference</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">osgi</span><span class="o">.</span><span class="na">framework</span><span class="o">.</span><span class="na">FrameworkUtil</span><span class="o">.*;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">GreeterCommands</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="n">String</span> <span class="nf">greet</span><span class="o">(){</span>
</span><span class='line'>        <span class="n">BundleContext</span> <span class="n">ctx</span> <span class="o">=</span> <span class="n">getBundle</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">bhn</span><span class="o">.</span><span class="na">training</span><span class="o">.</span><span class="na">api</span><span class="o">.</span><span class="na">Greeter</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
</span><span class='line'>                <span class="o">.</span><span class="na">getBundleContext</span><span class="o">();</span>
</span><span class='line'>        <span class="n">ServiceReference</span> <span class="n">ref</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">getServiceReference</span><span class="o">(</span>
</span><span class='line'>                <span class="n">org</span><span class="o">.</span><span class="na">bhn</span><span class="o">.</span><span class="na">training</span><span class="o">.</span><span class="na">api</span><span class="o">.</span><span class="na">Greeter</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
</span><span class='line'>        <span class="n">Greeter</span> <span class="n">greeter</span> <span class="o">=</span> <span class="o">(</span><span class="n">Greeter</span><span class="o">)</span> <span class="n">ctx</span><span class="o">.</span><span class="na">getService</span><span class="o">(</span><span class="n">ref</span><span class="o">);</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">greeter</span><span class="o">.</span><span class="na">greet</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p>This code shows the manual way to call a service from code. We will improve this later because there are easier ways of doing this, but this way at least demonstrates the classic steps of OSGi service calling:</p>

<ol>
<li>Get the BundleContext</li>
<li>Get the ServiceReference</li>
<li>Use the ServiceReference to get the Service</li>
<li>Call The Service</li>
</ol>


<p>Next we need to change the startup to register two services instead of one like so:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Registering Two Services</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">start</span><span class="o">(</span><span class="n">BundleContext</span> <span class="n">bundleContext</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">Hashtable</span> <span class="n">props</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Hashtable</span><span class="o">();</span>
</span><span class='line'>      <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;osgi.command.scope&quot;</span><span class="o">,</span><span class="s">&quot;tutorial&quot;</span><span class="o">);</span>
</span><span class='line'>      <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;osgi.command.function&quot;</span><span class="o">,</span><span class="k">new</span> <span class="n">String</span><span class="o">[]</span> <span class="o">{</span> <span class="s">&quot;greet&quot;</span> <span class="o">});</span>
</span><span class='line'>  
</span><span class='line'>      <span class="n">Hashtable</span> <span class="n">noprops</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Hashtable</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">registration</span> <span class="o">=</span> <span class="n">bundleContext</span>
</span><span class='line'>              <span class="o">.</span><span class="na">registerService</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">bhn</span><span class="o">.</span><span class="na">training</span><span class="o">.</span><span class="na">api</span><span class="o">.</span><span class="na">Greeter</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span>
</span><span class='line'>              <span class="k">new</span> <span class="nf">SimpleStringGreeterImpl</span><span class="o">(),</span><span class="n">noprops</span><span class="o">);</span>
</span><span class='line'>        <span class="n">command</span> <span class="o">=</span> <span class="n">bundleContext</span><span class="o">.</span><span class="na">registerService</span><span class="o">(</span>
</span><span class='line'>          <span class="n">org</span><span class="o">.</span><span class="na">bhn</span><span class="o">.</span><span class="na">training</span><span class="o">.</span><span class="na">commands</span><span class="o">.</span><span class="na">GreeterCommands</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span>
</span><span class='line'>            <span class="k">new</span> <span class="nf">GreeterCommands</span><span class="o">(),</span><span class="n">props</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p>Now after an <strong>felix:update</strong> you can call your command again and witness that its actually calling the service using the OSGi API.</p>

<p><em>Note: After looking at the Activator imagine you have more than two services to register. Now picture 10 or more. It can get a little verbose to register all these in code. Let&rsquo;s fix that. In the next tutorial we will convert this to use an xml file to declare the service components. This will improve the readability considerably.</em></p>

  
    <footer>
      <p class="meta">
        
        








  


<time datetime="2013-08-19T13:59:00-04:00" pubdate data-updated="true"></time>
        
      </p>
      
        <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://www.codeaffectionado.com/labs-and-tutorials/osgi/apache-felix-programmatic-bundle/index.html" data-via="mrjepp" data-counturl="http://www.codeaffectionado.com/labs-and-tutorials/osgi/apache-felix-programmatic-bundle/index.html" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

      
    </footer>
  
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    
  <section>
  <h1>Tutorial Steps</h1>
  <ol style="margin-left: 1.3em;"><li style="list-style:inherit;"><a href="#id-ef1e6887c579ba81dcedc3f4e3793cd2">Audience</a></li><li style="list-style:inherit;"><a href="#id-bedc3dcfdda44f13f3ab09697de200d4">Generate A Maven Quick Start Java Project</a></li><li style="list-style:inherit;"><a href="#id-e0bdd7a598f83ff5b041a606c7a05ad7">Change The POM</a></li><li style="list-style:inherit;"><a href="#id-71c5251db6987ffecb3cc64a74490f52">Starter Bundle Dependencies</a></li><li style="list-style:inherit;"><a href="#id-763452fa1c88e9094653309787c8f732">Examining The JARS</a></li><li style="list-style:inherit;"><a href="#id-8a988fc8ceb12d56742508f03e60f54f">Writing Our Interface</a></li><li style="list-style:inherit;"><a href="#id-579efc11d48e8ebbe67f9be59c8a3187">Writing The Implementation</a></li><li style="list-style:inherit;"><a href="#id-146ddd78ea3b666f65d84752f9c9658c">A Quick Note On Services</a></li><li style="list-style:inherit;"><a href="#id-12ed2e1a68f627e8ac67845f226676f6">Creating An Activator</a></li><li style="list-style:inherit;"><a href="#id-766ec51dd46abefd92a677496a504beb">Registering Services</a></li><li style="list-style:inherit;"><a href="#id-9a73094b2f39b810bfc0e87532916ac5">Exposing Our Interface Package</a></li><li style="list-style:inherit;"><a href="#id-ab6dd800317918d765936ecd09e5191f">Deploy Our Bundle</a></li><li style="list-style:inherit;"><a href="#id-61185d3aa7b26911ecf79a701c893ef7">Create A Gogo Shell Command</a></li></ol>
  </section>
<section>
	<h1>Lab/Tutorial Sections</h1>
	<ul id="recent_posts">
      <li class="post">
        <a href="/labs-and-tutorials/osgi/">OSGi</a>
      </li>
      <li>
      	<a href="/labs-and-tutorials/apache-jackrabbit/">Apache Jackrabbit</a>
      </li>
  </ul>
</section><section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/08/19/newest-osgi-tutorial-additions/">Newest OSGi Additions</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/08/17/apache-jackrabbit-starting-out/">Apache Jackrabbit - Starting From Scratch Tutorial Up</a>
      </li>
    
  </ul>
</section>

<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/114996005873710645329?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - jeff.downing@latchd.com -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'aggrolearning';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://www.codeaffectionado.com/labs-and-tutorials/osgi/apache-felix-programmatic-bundle/index.html';
        var disqus_url = 'http://www.codeaffectionado.com/labs-and-tutorials/osgi/apache-felix-programmatic-bundle/index.html';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
